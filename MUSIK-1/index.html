<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Пример Зайцев.НЕТ API</title>
<script src="https://cdn.jsdelivr.net/npm/js-md5@0.7.3/build/md5.min.js"></script>
</head>
<body>
<h2>Поиск треков Зайцев.НЕТ через неофициальный API</h2>
<input type="text" id="search" placeholder="Введите запрос" />
<button onclick="search()">Искать</button>
<pre id="output"></pre>

<script>
const API_BASE = 'https://api.zaycev.net/external';
const STATIC_KEY = 'kmskoNdkYHDnl3ol3'; // ключ может варьироваться, зависит от версии клиента

let helloToken = '';
let accessToken = '';
const output = document.getElementById('output');

async function hello() {
  const res = await fetch(`${API_BASE}/hello`);
  const data = await res.json();
  helloToken = data.token;
}

async function auth() {
  if (!helloToken) await hello();
  const hash = md5(helloToken + STATIC_KEY);
  const res = await fetch(`${API_BASE}/auth?code=${helloToken}&hash=${hash}`);
  const data = await res.json();
  if (data.token) {
    accessToken = data.token;
    output.textContent = 'Авторизация успешна. AccessToken получен.\n';
  } else {
    output.textContent = 'Ошибка авторизации\n' + JSON.stringify(data);
  }
}

async function search() {
  output.textContent = '';
  const query = document.getElementById('search').value.trim();
  if (!query) {
    output.textContent = 'Введите поисковый запрос';
    return;
  }
  if (!accessToken) {
    await auth();
  }

  const url = `${API_BASE}/search?query=${encodeURIComponent(query)}&page=1&type=track&sort=popular&style=&access_token=${accessToken}`;
  const res = await fetch(url);
  const data = await res.json();

  if (data.results && data.results.length > 0) {
    output.textContent += `Найдено ${data.results.length} треков:\n`;
    data.results.forEach((track, i) => {
      output.textContent += `${i + 1}. ${track.artist_name} — ${track.title}\n`;
      output.textContent += `URL для воспроизведения: ${track.url}\n\n`;
    });
  } else {
    output.textContent = 'Треков не найдено.';
  }
}
</script>
</body>
</html>
