<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VK Mini App с Jamendo API</title>
<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  button { font-size: 16px; margin: 5px; padding: 10px 15px; cursor: pointer;}
  pre { white-space: pre-wrap; max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; }
  input { font-size: 16px; padding: 5px; width: 300px; }
  audio { width: 100%; margin-top: 10px; }
</style>
</head>
<body>

<h2>VK Mini App с Jamendo API</h2>

<input type="text" id="searchInput" placeholder="Введите название песни или исполнителя" />
<button id="btnSearch">Поиск</button>

<pre id="output"></pre>
<div id="audioContainer"></div>

<script>
const VK_APP_ID = 54306429;
const CLIENT_ID = 'YOUR_JAMENDO_CLIENT_ID'; // Зарегистрируйтесь на https://developer.jamendo.com и получите client_id

const vkBridge = window.vkBridge;
const output = document.getElementById('output');
const btnSearch = document.getElementById('btnSearch');
const searchInput = document.getElementById('searchInput');
const audioContainer = document.getElementById('audioContainer');

function log(msg) {
  output.textContent += msg + "\\n";
  output.scrollTop = output.scrollHeight;
}

async function initializeVKBridge() {
  try {
    await vkBridge.send('VKWebAppInit');
    log('VK Bridge инициализирован');
  } catch (e) {
    log('Ошибка инициализации VK Bridge: ' + (e.message || e));
  }
}

async function searchJamendo(query) {
  output.textContent = '';
  audioContainer.innerHTML = '';
  if (!query) {
    log('Введите запрос для поиска');
    return;
  }
  try {
    const url = `https://api.jamendo.com/v3.0/tracks/?client_id=${CLIENT_ID}&format=json&limit=10&search=${encodeURIComponent(query)}`;
    const response = await fetch(url);
    const data = await response.json();

    if (data.results && data.results.length > 0) {
      log(`Найдено треков: ${data.results.length}`);
      data.results.forEach((track, i) => {
        log(`${i+1}. ${track.artist_name} — ${track.name}`);

        // Добавляем аудиоплеер
        const audio = document.createElement('audio');
        audio.controls = true;
        audio.src = track.audio;
        audioContainer.appendChild(audio);

        // Текстовое описание под аудиоплеером
        const div = document.createElement('div');
        div.textContent = `${track.artist_name} — ${track.name}`;
        audioContainer.appendChild(div);
      });
    } else {
      log('По вашему запросу треков не найдено.');
    }
  } catch (e) {
    log('Ошибка при запросе к Jamendo API: ' + e.message);
  }
}

btnSearch.onclick = () => {
  searchJamendo(searchInput.value.trim());
};

// Инициализация VK Bridge при загрузке страницы
initializeVKBridge();

</script>
</body>
</html>
