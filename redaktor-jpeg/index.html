<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–†–µ–¥–∞–∫—Ç–æ—Ä –æ–±–ª–æ–∂–µ–∫ –¥–ª—è –≤–∫</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body {
    margin: 0;
    padding: 8px;
    font-family: Arial, sans-serif;
    background: url("https://raw.githubusercontent.com/NEW-nik-1/R-tv/refs/heads/main/redaktor-jpeg/background-vk.jpg") no-repeat center center fixed;
    background-size: cover;
    color: #e0e0e0;
    display: flex;
    justify-content: center;
}
.container {
    width: 680px;
    text-align: center;
}
h2 { font-size: 16px; margin-bottom: 6px; }
#canvasWrap { padding: 4px; box-shadow:0 0 4px #999; margin-bottom: 12px; }
canvas { background: #222; cursor: grab; width: 640px; height: 252px; border-radius: 4px; }
.flex-row, .links-buttons {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content:center;
    align-items:center;
    margin-bottom:12px;
}
button, .icon-btn {
    font-size: 11px;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.2s ease;
}
button:hover,
.icon-btn:hover {
    background-color: #BDB76B;
    color: #fff;
    transform: scale(1.05);
    box-shadow: 0 0 6px rgba(0,0,0,0.4);
}
#scaleControl { width: 640px; display:none; margin-bottom: 12px; justify-content: center; align-items: center; }
.slider-wrapper { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.author-label { font-size: 11px; color: rgba(180,180,180,0.4); text-decoration:none; display:inline-block; padding:3px 6px; background:#222; border-radius:4px; margin-top:60px; }

/* üîπ –°—Ç–∏–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.7);
}
.modal-content {
  background-color: #222;
  margin: 6% auto;
  padding: 20px;
  border-radius: 8px;
  width: 80%; max-width: 640px;
  color: #ddd;
  font-size: 14px;
  line-height: 1.5;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
  text-align: left;
}
.modal-content h2 { margin-top: 0; color: #ffcc66; }
.close {
  color: #aaa;
  float: right;
  font-size: 22px;
  font-weight: bold;
  cursor: pointer;
}
.close:hover { color: #fff; }
</style>
</head>
<body>
<div class="container">

<h2> –†–µ–¥–∞–∫—Ç–æ—Ä –æ–±–ª–æ–∂–µ–∫ –¥–ª—è –≤–∫ </h2>

<div class="flex-row">
  <button id="loadBgBtn"><i class="fa-solid fa-image"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω</button>
  <input type="file" id="bgFile" accept="image/*" style="display:none;">
  
  <button id="addImg1Btn"><i class="fa-solid fa-photo-film"></i> –ö–∞—Ä—Ç–∏–Ω–∫–∞ 1</button>
  <input type="file" id="addImgFile1" accept="image/*" style="display:none;">
  
  <button id="addImg2Btn"><i class="fa-solid fa-photo-film"></i> –ö–∞—Ä—Ç–∏–Ω–∫–∞ 2</button>
  <input type="file" id="addImgFile2" accept="image/*" style="display:none;">
  
  <!-- üîπ –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
  <button id="helpBtn"><i class="fa-solid fa-circle-question"></i> –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
</div>

<div id="canvasWrap">
  <canvas id="canvas" width="640" height="252"></canvas>
</div>

<div id="scaleControl">
  <label style="font-size:12px;">–†–∞–∑–º–µ—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ (px)</label>
  <div class="slider-wrapper">
    <div class="icon-btn" id="decrease">‚àí</div>
    <input type="range" id="scaleSlider" min="50" max="500" step="1" value="200">
    <div class="icon-btn" id="increase">+</div>
    <span id="scaleValue">200</span>
    <label style="display:flex; align-items:center; gap:4px; font-size:12px; margin-left:8px;">
      <input type="checkbox" id="flipHoriz"> <i class="fa-solid fa-arrows-left-right"></i> –ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
    </label>
  </div>
</div>

<div class="flex-row">
  <select id="formatSelect">
    <option value="jpeg">JPG</option>
    <option value="png">PNG</option>
  </select>
  <input type="number" id="widthInput" value="1920" min="100" style="width:60px;"> √ó 
  <input type="number" id="heightInput" value="768" min="100" style="width:60px;">
  <button id="saveImageBtn"><i class="fa-solid fa-download"></i> –°–∫–∞—á–∞—Ç—å</button>
</div>

<div class="links-buttons">
  <button onclick="window.open('https://www.photoroom.com/ru/instrumenty/ubrat-fon-onlayn', '_blank')">
    <i class="fa-solid fa-scissors"></i> –£–±—Ä–∞—Ç—å —Ñ–æ–Ω (Photoroom)
  </button>
  <button onclick="window.open('https://carve.photos/', '_blank')">
    <i class="fa-solid fa-cut"></i> –£–±—Ä–∞—Ç—å —Ñ–æ–Ω (Carve.photos)
  </button>
  <button onclick="window.open('https://ru.textstudio.com/', '_blank')">
    <i class="fa-solid fa-font"></i> –ö—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç (TextStudio)
  </button>
  <button onclick="window.open('https://textdrom.com/vintage-text-effect.html', '_blank')">
    <i class="fa-solid fa-font"></i> –ö—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç (TextDrom)
  </button>
</div>

<div>
  <a class="author-label" href="https://vk.com/muzer_play" target="_blank">
    <i class="fa-solid fa-user"></i> –ê–≤—Ç–æ—Ä: MUZER play + ( ChatGPT )
  </a>
</div>
</div>

<!-- üîπ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π -->
<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>üìò –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –æ–±–ª–æ–∂–µ–∫</h2>
    <ol>
      <li><b>–ó–∞–ø—É—Å–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</b><br>
      –ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Google Chrome –∏–ª–∏ –¥—Ä—É–≥–æ–º) –ø–æ—è–≤–∏—Ç—Å—è –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±–ª–æ–∂–∫–∏.</li><br>

      <li><b>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–∞</b><br>
      –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω¬ª ‚Üí –≤—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É ‚Üí —Ñ–æ–Ω –∑–∞–π–º–µ—Ç –≤–µ—Å—å —Ö–æ–ª—Å—Ç.</li><br>

      <li><b>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫</b><br>
      –ù–∞–∂–º–∏ ¬´–ö–∞—Ä—Ç–∏–Ω–∫–∞ 1¬ª –∏–ª–∏ ¬´–ö–∞—Ä—Ç–∏–Ω–∫–∞ 2¬ª ‚Üí –≤—ã–±–µ—Ä–∏ —Ñ–∞–π–ª (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–¥–ø–∏—Å—å) ‚Üí —ç–ª–µ–º–µ–Ω—Ç –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–≤–µ—Ä—Ö —Ñ–æ–Ω–∞.<br>
      –ù–æ–≤—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ –∏ –ø—Ä–∞–≤–µ–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π.</li><br>

      <li><b>–†–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏</b><br>
        üîÑ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ ‚Äî –ø–µ—Ä–µ—Ç–∞—â–∏ –º—ã—à–∫–æ–π.<br>
        üîç –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª–∑—É–Ω–æ–∫ (50‚Äì500 px) –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ ¬´+¬ª –∏ ¬´‚àí¬ª.<br>
        ‚Üî –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç ‚Äî –≥–∞–ª–æ—á–∫–∞ ¬´–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ¬ª.<br>
        ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ ‚Äî –∫–ª–∏–∫ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏.</li><br>

      <li><b>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–ª–æ–∂–∫–∏</b><br>
      –í—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç (JPG –∏–ª–∏ PNG), –∑–∞–¥–∞–π —Ä–∞–∑–º–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1920√ó768), –Ω–∞–∂–º–∏ ¬´–°–∫–∞—á–∞—Ç—å¬ª.<br>
      –í–Ω–∏–∑—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ø–æ–¥–ø–∏—Å—å ¬´–†–µ–¥–∞–∫—Ç–æ—Ä –æ–±–ª–æ–∂–µ–∫ –¥–ª—è –≤–∫¬ª.</li><br>

      <li><b>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏</b><br>
      –£–±—Ä–∞—Ç—å —Ñ–æ–Ω (Photoroom / Carve.photos) ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞.<br>
      –ö—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç (TextStudio / TextDrom) ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä.</li><br>

      <li><b>–°–æ–≤–µ—Ç—ã</b><br>
      –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–π —Ñ–æ–Ω, –ø–æ—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –Ω–∞–¥–ø–∏—Å—å.<br>
      –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–æ–π ‚Äî —É–º–µ–Ω—å—à–∏ –µ–≥–æ –ø–æ–ª–∑—É–Ω–∫–æ–º.<br>
      –†–∞–∑–º–µ—â–∞–π —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–∏ –≤–∞–∂–Ω—ã–µ —á–∞—Å—Ç–∏.<br>
      –ò—Å–ø–æ–ª—å–∑—É–π —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –¥–ª—è –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏.</li>
    </ol>
  </div>
</div>

<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
<script>
(async () => {
  try {
    await vkBridge.send('VKWebAppInit');
    console.log('VK Bridge –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
  } catch (e) {
    console.warn('VK Bridge initialization failed or unavailable', e);
  }
})();
</script>

<script>
// ===== –ö–æ–¥ —Ä–∞–±–æ—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ =====
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let bgImage = null;
let images = [];
let selectedIndex = -1, dragging = false;
let dragOffsetX = 0, dragOffsetY = 0;

const scaleControl = document.getElementById('scaleControl');
const scaleSlider = document.getElementById('scaleSlider');
const scaleValue = document.getElementById('scaleValue');
const decreaseBtn = document.getElementById('decrease');
const increaseBtn = document.getElementById('increase');
const flipCheckbox = document.getElementById('flipHoriz');

let lastOffsetX = 40; 
let lastOffsetY = 40;

class ImageObject {
  constructor(img, x=0, y=0){
    this.img = img;
    this.x = x;
    this.y = y;
    this.width = 200;
    this.height = 200 * img.height / img.width;
    this.flip = false;
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(bgImage) ctx.drawImage(bgImage,0,0,canvas.width,canvas.height);
  images.forEach(imgObj=>{
    ctx.save();
    ctx.translate(imgObj.x + imgObj.width/2, imgObj.y + imgObj.height/2);
    ctx.scale(imgObj.flip ? -1 : 1, 1);
    ctx.drawImage(imgObj.img, -imgObj.width/2, -imgObj.height/2, imgObj.width, imgObj.height);
    ctx.restore();
  });
}

function addImage(input){
  const f = input.files[0]; 
  if(!f) return;
  const img = new Image();
  img.onload = () => {
    lastOffsetX += 20;
    lastOffsetY += 20;
    if(lastOffsetX > canvas.width - 200) lastOffsetX = 40;
    if(lastOffsetY > canvas.height - 200) lastOffsetY = 40;
    const imgObj = new ImageObject(img, lastOffsetX, lastOffsetY);
    images.push(imgObj);
    selectedIndex = images.length-1;
    updateScaleControl(imgObj);
    draw();
  };
  img.src = URL.createObjectURL(f);
  input.value = '';
}

function updateScaleControl(imgObj){
  scaleSlider.value = imgObj.width;
  scaleValue.textContent = imgObj.width;
  flipCheckbox.checked = imgObj.flip;
  scaleControl.style.display = 'flex';
}

document.getElementById('loadBgBtn').onclick = () => document.getElementById('bgFile').click();
document.getElementById('bgFile').addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const img = new Image();
  img.onload = () => { bgImage = img; draw(); };
  img.src = URL.createObjectURL(f);
});

document.getElementById('addImg1Btn').onclick = () => document.getElementById('addImgFile1').click();
document.getElementById('addImg2Btn').onclick = () => document.getElementById('addImgFile2').click();
document.getElementById('addImgFile1').addEventListener('change', (e)=>addImage(e.target));
document.getElementById('addImgFile2').addEventListener('change', (e)=>addImage(e.target));

canvas.addEventListener('mousedown',(e)=>{
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  dragging = false;
  for(let i=images.length-1;i>=0;i--){
    const img=images[i];
    if(mouseX>=img.x && mouseX<=img.x+img.width && mouseY>=img.y && mouseY<=img.y+img.height){
      selectedIndex=i;
      dragOffsetX=mouseX-img.x;
      dragOffsetY=mouseY-img.y;
      dragging=true;
      updateScaleControl(img);
      draw();
      return;
    }
  }
});

canvas.addEventListener('contextmenu',(e)=>{
  e.preventDefault();
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  for(let i=images.length-1;i>=0;i--){
    const img=images[i];
    if(mouseX>=img.x && mouseX<=img.x+img.width && mouseY>=img.y && mouseY<=img.y+img.height){
      images.splice(i,1);
      if(images.length>0){
        selectedIndex = images.length-1;
        updateScaleControl(images[selectedIndex]);
      } else {
        selectedIndex = -1;
        scaleControl.style.display = 'none';
      }
      draw();
      return;
    }
  }
});

canvas.addEventListener('mousemove',(e)=>{
  if(!dragging) return;
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  if(selectedIndex>=0){
    images[selectedIndex].x=mouseX-dragOffsetX;
    images[selectedIndex].y=mouseY-dragOffsetY;
    draw();
  }
});
window.addEventListener('mouseup',()=>{ dragging=false; });

function updateImageSize(width){
  if(selectedIndex>=0){
    const imgObj=images[selectedIndex];
    imgObj.width=width;
    imgObj.height=width*imgObj.img.height/imgObj.img.width;
    scaleSlider.value=width;
    scaleValue.textContent=width;
    draw();
  }
}

scaleSlider.addEventListener('input',()=>{ updateImageSize(parseInt(scaleSlider.value)); });
decreaseBtn.addEventListener('click',()=>{ updateImageSize(Math.max(50,parseInt(scaleSlider.value)-10)); });
increaseBtn.addEventListener('click',()=>{ updateImageSize(Math.min(500,parseInt(scaleSlider.value)+10)); });
flipCheckbox.addEventListener('change',()=>{ if(selectedIndex>=0){ images[selectedIndex].flip=flipCheckbox.checked; draw(); } });

document.getElementById('saveImageBtn').onclick=()=>{
  const format=document.getElementById('formatSelect').value;
  let width=parseInt(document.getElementById('widthInput').value);
  let height=parseInt(document.getElementById('heightInput').value);
  if(isNaN(width)||width<100) width=1920;
  if(isNaN(height)||height<100) height=768;

  const tmpCanvas=document.createElement('canvas');
  tmpCanvas.width=width;
  tmpCanvas.height=height;
  const tmpCtx=tmpCanvas.getContext('2d');

  if(bgImage) tmpCtx.drawImage(bgImage,0,0,width,height);
  images.forEach(imgObj=>{
    tmpCtx.save();
    tmpCtx.translate((imgObj.x/canvas.width)*width + (imgObj.width/2)*(width/canvas.width),
                     (imgObj.y/canvas.height)*height + (imgObj.height/2)*(height/canvas.height));
    tmpCtx.scale(imgObj.flip?-1:1,1);
    tmpCtx.drawImage(imgObj.img,
      -(imgObj.width/2)*(width/canvas.width),
      -(imgObj.height/2)*(height/canvas.height),
      imgObj.width*(width/canvas.width),
      imgObj.height*(height/canvas.height)
    );
    tmpCtx.restore();
  });

  // üîπ –í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫
  tmpCtx.save();
  tmpCtx.font = "italic 16px cursive";
  tmpCtx.fillStyle = "rgba(255,255,255,0.2)";
  tmpCtx.textAlign = "right";
  tmpCtx.textBaseline = "bottom";
  tmpCtx.fillText("–†–µ–¥–∞–∫—Ç–æ—Ä –æ–±–ª–æ–∂–µ–∫ –¥–ª—è –≤–∫", width - 12, height - 8);
  tmpCtx.restore();

  const link=document.createElement('a');
  link.download='image.'+(format==='jpeg'?'jpg':'png');
  link.href=tmpCanvas.toDataURL('image/'+format);
  link.click();
};

draw();

// ===== –ö–æ–¥ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ =====
const helpBtn = document.getElementById("helpBtn");
const helpModal = document.getElementById("helpModal");
const closeBtn = document.querySelector(".modal .close");

helpBtn.onclick = () => { helpModal.style.display = "block"; };
closeBtn.onclick = () => { helpModal.style.display = "none"; };
window.onclick = (e) => { if (e.target === helpModal) helpModal.style.display = "none"; };
</script>

</body>
</html>

