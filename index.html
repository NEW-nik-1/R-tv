<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TV / Radio / Games — Single File Interface</title>

  <style>
    /* --- Общие стили --- */
    :root {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }
    html, body {
      overflow: hidden; /* отключаем скроллинг основной страницы */
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #e6eef8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;

      /* Уменьшаем масштаб всей страницы */
      transform: scale(0.8);
      transform-origin: 0 0;
      width: 125vw;
      height: 125vh;
      min-height: 100vh;
    }

    /* --- Хедер с вкладками --- */
    header {
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 20px;
      background: rgba(11, 18, 32, 0.8); /* прозрачный фон */
      align-items: center;
      width: 100%;
      max-width: 820px;
      box-sizing: border-box;
    }

    /* Стили кнопок вкладок */
    button.tab {
      background: linear-gradient(180deg,#3a6ea5,#224566);
      border: 2px solid #1b2b3a;
      color: #fff;
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 4px #142738, 0 6px 10px rgba(0,0,0,.6);
      transition: all .2s ease;
    }
    button.tab:hover { /* эффект наведения */
      transform: translateY(-2px);
      box-shadow: 0 6px #142738, 0 8px 14px rgba(0,0,0,.6);
    }
    button.tab:active { /* эффект нажатия */
      transform: translateY(2px);
      box-shadow: 0 2px #142738, 0 4px 8px rgba(0,0,0,.6);
    }
    button.tab.active { /* активная вкладка */
      background: linear-gradient(180deg,#4b90d0,#32628c);
    }

    /* --- Основной контейнер контента --- */
    main {
      padding: 18px;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 820px;
      box-sizing: border-box;
      gap: 12px;
    }

    /* --- ТВ iframe --- */
    #tv-iframe-container {
      display: none; /* скрыт по умолчанию */
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid rgba(34, 50, 70, 0.5);
      width: 100%;
      max-width: 590px;
      height: 780px;
    }
    #tv-iframe {
      width: 100%;
      height: 100%;
    }

    /* --- Радио --- */
    #radio-player {
      display: none; /* скрыт по умолчанию */
      padding: 10px;
      background: rgba(7, 16, 24, 0.5);
      border-radius: 10px;
      border: 1px solid rgba(33, 50, 67, 0.5);
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-sizing: border-box;
      align-items: center;
    }
    #radio-controls {
      width: 100%;
      display: flex;
      justify-content: center;
    }
    #radio-audio {
      width: 700px;
      max-width: 100%;
      box-sizing: border-box;
      margin-bottom: 4px;
    }
    #radio-list {
      max-height: 500px; /* увеличенная высота списка радиостанций */
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }

    /* Стили радио-каналов */
    #channels {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }
    .channel {
      padding: 12px 16px;
      background: rgba(14, 35, 50, 0.55);
      color: #e6eef8;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid rgba(21, 50, 72, 0.5);
      cursor: pointer;
      transition: background-color 0.2s,color 0.2s;
      user-select: none;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .channel:hover { /* эффект наведения */
      background-color: rgba(34, 68, 102, 0.7);
      color: #fff;
    }
    .channel.selected { /* выбранный канал */
      background-color: rgba(42, 107, 154, 0.7);
      color: #fff;
      border-color: rgba(42, 107, 154, 0.8);
    }

    /* --- Игры --- */
    #games-overlay {
      display: none; /* скрыт по умолчанию */
      padding: 12px;
      background: rgba(7, 16, 24, 0.5);
      border-radius: 10px;
      border: 1px solid rgba(33, 50, 67, 0.5);
      max-height: 600px;
      width: 400px;
      overflow: hidden;
      flex-direction: column;
    }
    #games-list {
      flex: 1;
      height: 750px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .game-item { /* каждая игра */
      padding: 14px 16px;
      background: rgba(14, 35, 50, 0.55);
      border-radius: 8px;
      cursor: pointer;
      border: 1px solid rgba(21, 50, 72, 0.5);
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      color: #fff;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .game-item:hover { /* эффект наведения */
      background: rgba(14, 35, 50, 0.7) !important;
      color: #fff !important;
      cursor: pointer;
    }

    /* --- Окно игры --- */
    #game-window {
      display: none;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 720px;
      height: 480px;
      background: rgba(7, 16, 24, 0.5);
      border: 1px solid rgba(41, 64, 80, 0.5);
      border-radius: 10px;
      box-shadow: 0 12px 40px rgba(2, 7, 14, 0.7);
      overflow: hidden;
      z-index: 999;
    }
    #game-header { /* заголовок окна игры с кнопками управления */
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 8px;
      background: linear-gradient(180deg, rgba(11, 26, 36, 0.8), rgba(7, 32, 43, 0.8));
      gap: 8px;
    }
    #game-title {
      font-size: 14px;
    }
    #game-controls {
      display: flex;
      gap: 6px;
    }
    .gbtn { /* кнопки управления окном игры */
      background: rgba(14, 41, 54, 0.8);
      border: 0;
      padding: 6px 8px;
      border-radius: 6px;
      cursor: pointer;
      color: #bfe1ff;
    }
    #game-iframe {
      width: 100%;
      height: calc(100% - 40px); /* вычитаем высоту заголовка */
      border: 0;
    }
    #game-window.minimized { /* свернутое окно */
      height: 42px;
      width: 260px;
      left: 0;
      bottom: 0;
      top: auto;
      transform: none;
    }
    #game-window.fullscreen { /* полноэкранное окно */
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      border-radius: 0;
      transform: none;
    }

    /* --- Кнопка и модальное окно помощи --- */
    #help-main-btn { /* кнопка справки в хедере */
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 2px solid rgba(27, 43, 58, 0.5);
      background: rgba(34, 69, 102, 0.8);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
      margin-left: 8px;
    }
    #help-main-btn:hover {
      background: rgba(47, 107, 156, 0.9);
    }
    #help-modal { /* модальное окно справки */
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none; /* скрыто по умолчанию */
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    #help-content {
      background: rgba(15, 30, 44, 0.9);
      color: #fff;
      padding: 20px;
      max-width: 600px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
      max-height: 80vh;
      overflow-y: auto;
    }
    #close-help {
      margin-top: 15px;
      padding: 10px 20px;
      cursor: pointer;
      background: rgba(42, 107, 154, 0.9);
      color: #fff;
      border: none;
      border-radius: 8px;
    }

    /* --- Нижний текст --- */
    #bottom-text {
      padding: 20px 20px;
      background: transparent;
      color: #FFE2B7;
      font-size: 15px;
      text-align: left;
      width: 100%;
      max-width: 820px;
      box-sizing: border-box;
      margin: 0 auto 10px auto;
    }

    /* --- Стилизация скроллбаров --- */
    #radio-list::-webkit-scrollbar,
    #games-list::-webkit-scrollbar {
      width: 12px;
    }
    #radio-list::-webkit-scrollbar-track,
    #games-list::-webkit-scrollbar-track {
      background: transparent;
    }
    #radio-list::-webkit-scrollbar-thumb,
    #games-list::-webkit-scrollbar-thumb {
      background-color: #063971;
      border-radius: 6px;
      border: 3px solid transparent;
      background-clip: content-box;
    }
    #radio-list,
    #games-list {
      scrollbar-width: thin;
      scrollbar-color: #063971 transparent;
    }
  </style>
</head>
<body>
  <!-- --- Хедер с вкладками --- -->
  <header>
    <button id="btn-tv" class="tab">ТВ</button>
    <button id="btn-radio" class="tab">РАДИО</button>
    <button id="btn-games" class="tab">ИГРЫ</button>
    <button id="help-main-btn" title="Инструкция">?</button>
  </header>

  <!-- --- Основной контент --- -->
  <main>
    <!-- ТВ iframe контейнер -->
    <section id="tv-iframe-container">
      <iframe id="tv-iframe" src="https://smotret.tv/" width="500" height="300" frameborder="0" allowfullscreen title="Смотреть ТВ"></iframe>
    </section>

    <!-- Радио плеер -->
    <section id="radio-player">
      <div id="radio-controls">
        <audio id="radio-audio" controls></audio>
      </div>
      <div id="radio-list">
        <div id="channels"></div> <!-- контейнер кнопок каналов -->
      </div>
    </section>

    <!-- Игры -->
    <section id="games-overlay">
      <div id="games-list"></div>
    </section>
  </main>

  <!-- --- Окно игры --- -->
  <div id="game-window" aria-hidden="true">
    <div id="game-header">
      <div id="game-title">Игра</div>
      <div id="game-controls">
        <button id="minimize-btn" class="gbtn">▽</button>
        <button id="restore-btn" class="gbtn" style="display:none">△</button>
        <button id="fs-enter" class="gbtn">❏</button>
        <button id="fs-exit" class="gbtn" style="display:none">❏ (windowed)</button>
        <button id="help-btn" class="gbtn" title="Звук игры отключается в настройках игры">?</button>
        <button id="close-game-btn" class="gbtn">✖</button>
      </div>
    </div>
    <iframe id="game-iframe" src="" title="Game iframe"></iframe>
  </div>

  <!-- --- Модальное окно справки --- -->
  <div id="help-modal">
    <div id="help-content">
      <h2>Инструкция</h2>
      <p><b>Вкладки:</b> ТВ, РАДИО, ИГРЫ — переключают режим интерфейса.</p>
      <p><b>РАДИО:</b> выберите станцию и вручную нажмите Play, если автозапуск не сработал.</p>
      <p><b>ИГРЫ:</b> выберите игру из списка. Кнопки управления окном игры:</p>
      <ul>
        <li>▽ — свернуть</li>
        <li>△ — восстановить</li>
        <li>❏ — во весь экран</li>
        <li>✖ — закрыть игру</li>
      </ul>
      <p><b>Горячие клавиши:</b></p>
      <ul>
        <li>1 = ТВ</li>
        <li>2 = РАДИО</li>
        <li>3 = ИГРЫ</li>
        <li>Escape = закрыть окно, игру, справку</li>
      </ul>
      <button id="close-help">Закрыть</button>
    </div>
  </div>

  <div id="bottom-text">
    Интерфейс ТВ/РАДИО/ИГРЫ — Придумал, сделал. MUZER play.
  </div>

  <!-- VK Bridge -->
  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
  <script>
    // Инициализация VK Bridge для интеграции с VK Mini Apps
    (async () => {
      try {
        await vkBridge.send('VKWebAppInit');
      } catch (e) {
        console.warn('VK Bridge initialization failed or unavailable', e);
      }
    })();
  </script>

  <!-- Основной JS функционал -->
  <script>
    /* --- Данные радиостанций и игр --- */
    const RADIO_CHANNELS = [
      { name: "Радио Рекорд", url: "https://radiorecord.hostingradio.ru/rr_main96.aacp" },
      { name: "Наше радио", url: "https://nashe1.hostingradio.ru/nashe-256" },
      { name: "Радио Шкипер", url: "https://myradio24.org/bolshevek" },
      { name: "Радио Лучшие Песни", url: "https://rbs.amgradio.ru/rbs?r_bells" },
      { name: "Радио Движение", url: "https://c4.radioboss.fm:18218/stream" }
    ];
    const GAMES = [
      { name: "Gary's World", url: "https://html5.gamemonetize.co/dd5rs8etri5hw51g32sk69qfdoov5tq2/" },
      { name: "Crazy Ball Adventures", url: "https://www.onlinegames.io/games/2021/unity2/crazy-ball-adventures/index.html" },
      { name: "Subway Horror Chapter 1", url: "https://www.gamenora.com/embed/subway-horror-chapter-1" },
      { name: "A Difficult Game About Climbing", url: "https://www.gamenora.com/embed/a-difficult-game-about-climbing" },
      { name: "Cross The Road", url: "https://www.onlinegames.io/games/2023/unity/cross-the-road/index.html" },
      { name: "Motorcycle Racer", url: "https://s3.eponesh.com/games/8866/" },
      { name: "Moto Rider GO", url: "https://app-165758.games.s3.yandex.net/165758/ghtg4xyuxt09og6gtji0jcl6aw8el4w4/index.html" },
      { name: "Motorbike Traffic", url: "https://www.onlinegames.io/games/2021/unity/motorbike-traffic/index.html" },
      { name: "Turbo Moto Racer 3D", url: "https://www.gamenora.com/splash/turbo-moto-racer-3d/" },
      { name: "ATV Highway Traffic", url: "https://www.onlinegames.io/games/2021/unity/atv-highway-traffic/index.html" },
      { name: "Traffic Tour", url: "https://traffictour.github.io/traffic-tour/" }
    ];

    /* --- Получаем DOM элементы --- */
    const btnTV = document.getElementById('btn-tv');
    const btnRadio = document.getElementById('btn-radio');
    const btnGames = document.getElementById('btn-games');
    const tvContainer = document.getElementById('tv-iframe-container');
    const radioPlayer = document.getElementById('radio-player');
    const radioAudio = document.getElementById('radio-audio');
    const channelsDiv = document.getElementById('channels');
    const gamesOverlay = document.getElementById('games-overlay');
    const gamesList = document.getElementById('games-list');
    const gameWindow = document.getElementById('game-window');
    const gameIframe = document.getElementById('game-iframe');
    const gameTitle = document.getElementById('game-title');
    const minimizeBtn = document.getElementById('minimize-btn');
    const restoreBtn = document.getElementById('restore-btn');
    const fsEnter = document.getElementById('fs-enter');
    const fsExit = document.getElementById('fs-exit');
    const closeGameBtn = document.getElementById('close-game-btn');
    const helpBtn = document.getElementById('help-main-btn');
    const helpModal = document.getElementById('help-modal');
    const closeHelp = document.getElementById('close-help');

    let selectedChannelUrl = null; // хранит URL текущего радио

    /* --- Функция для установки активной вкладки --- */
    function setActiveButton(button) {
      [btnTV, btnRadio, btnGames].forEach(b => b.classList.toggle('active', b === button));
    }

    /* --- События на вкладки --- */
    btnTV.addEventListener('click', () => {
      setActiveButton(btnTV);
      tvContainer.style.display = 'block';
      radioPlayer.style.display = 'none';
      stopRadioAudio();
      gamesOverlay.style.display = 'none';
      closeGame();
    });
    btnRadio.addEventListener('click', () => {
      setActiveButton(btnRadio);
      radioPlayer.style.display = 'flex';
      tvContainer.style.display = 'none';
      gamesOverlay.style.display = 'none';
      if (selectedChannelUrl) radioAudio.style.display = 'inline-block';
    });
    btnGames.addEventListener('click', () => {
      setActiveButton(btnGames);
      gamesOverlay.style.display = 'flex';
      tvContainer.style.display = 'none';
      radioPlayer.style.display = 'none';
    });

    /* --- Функции для отображения каналов и игр --- */
    function renderChannels() {
      channelsDiv.innerHTML = '';
      RADIO_CHANNELS.forEach((ch, idx) => {
        const btn = document.createElement('button');
        btn.className = 'channel';
        btn.textContent = `${idx + 1}. ${ch.name}`;
        btn.title = ch.name;
        btn.addEventListener('click', () => selectChannel(ch));
        btn.dataset.url = ch.url;
        channelsDiv.appendChild(btn);
      });
    }
    function renderGames() {
      gamesList.innerHTML = '';
      GAMES.forEach((g, idx) => {
        const btn = document.createElement('button');
        btn.className = 'game-item';
        btn.textContent = `${idx + 1}. ${g.name}`;
        btn.title = g.name;
        btn.addEventListener('click', () => openGame(g));
        gamesList.appendChild(btn);
      });
    }

    /* --- Выбор радиостанции --- */
    function selectChannel(channel) {
      selectedChannelUrl = channel.url;
      Array.from(channelsDiv.children).forEach(btn =>
        btn.classList.toggle('selected', btn.dataset.url === channel.url)
      );
      radioAudio.src = channel.url;
      radioAudio.style.display = 'inline-block';
      try { radioAudio.play(); } catch {}
    }

    function stopRadioAudio() {
      try {
        radioAudio.pause();
        radioAudio.currentTime = 0;
        radioAudio.src = '';
      } catch (e) {}
    }

    /* --- Управление окном игры --- */
    function openGame(game) {
      gameTitle.textContent = game.name;
      gameIframe.src = game.url;
      gameWindow.style.display = 'block';
      gameWindow.setAttribute('aria-hidden', 'false');
      gameWindow.classList.remove('minimized', 'fullscreen');
      restoreBtn.style.display = 'none';
      minimizeBtn.style.display = 'inline-block';
      fsEnter.style.display = 'inline-block';
      fsExit.style.display = 'none';
    }
    minimizeBtn.addEventListener('click', () => {
      gameWindow.classList.add('minimized');
      minimizeBtn.style.display = 'none';
      restoreBtn.style.display = 'inline-block';
    });
    restoreBtn.addEventListener('click', () => {
      gameWindow.classList.remove('minimized');
      restoreBtn.style.display = 'none';
      minimizeBtn.style.display = 'inline-block';
    });
    fsEnter.addEventListener('click', async () => {
      if (gameWindow.requestFullscreen) {
        try {
          await gameWindow.requestFullscreen();
          gameWindow.classList.add('fullscreen');
          fsEnter.style.display = 'none';
          fsExit.style.display = 'inline-block';
        } catch (e) { console.warn('Fullscreen failed', e); }
      } else {
        gameWindow.classList.add('fullscreen');
        fsEnter.style.display = 'none';
        fsExit.style.display = 'inline-block';
      }
    });
    fsExit.addEventListener('click', async () => {
      if (document.fullscreenElement) {
        try {
          await document.exitFullscreen();
          gameWindow.classList.remove('fullscreen');
          fsEnter.style.display = 'inline-block';
          fsExit.style.display = 'none';
        } catch (e) { console.warn('Exit fullscreen failed', e); }
      } else {
        gameWindow.classList.remove('fullscreen');
        fsEnter.style.display = 'inline-block';
        fsExit.style.display = 'none';
      }
    });
    closeGameBtn.addEventListener('click', () => { closeGame(); });
    function closeGame() {
      gameWindow.style.display = 'none';
      gameWindow.classList.remove('minimized', 'fullscreen');
      gameWindow.setAttribute('aria-hidden', 'true');
      try { gameIframe.src = ''; } catch (e) {}
    }

    /* --- Модальное окно справки --- */
    helpBtn.addEventListener('click', () => { helpModal.style.display = 'flex'; });
    closeHelp.addEventListener('click', () => { helpModal.style.display = 'none'; });

    /* --- Горячие клавиши --- */
    document.addEventListener('keydown', (e) => {
      if (e.key === '1') btnTV.click();
      if (e.key === '2') btnRadio.click();
      if (e.key === '3') btnGames.click();
      if (e.key === 'Escape') {
        closeGame();
        helpModal.style.display = 'none';
        if (gamesOverlay.style.display === 'flex') gamesOverlay.style.display = 'none';
      }
    });

    /* --- Инициализация интерфейса --- */
    renderChannels();
    renderGames();
  </script>
</body>
</html>
